var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function r(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function f(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){t.value=null==e?"":e}function g(t,e){for(let n=0;n<t.options.length;n+=1){const i=t.options[n];if(i.__value===e)return void(i.selected=!0)}}function p(t,e,n){t.classList[n?"add":"remove"](e)}let v;function $(t){v=t}function b(){if(!v)throw new Error("Function called outside component initialization");return v}function y(){const t=b();return(e,n)=>{const i=t.$$.callbacks[e];if(i){const o=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);i.slice().forEach((e=>{e.call(t,o)}))}}}const x=[],w=[],_=[],k=[],E=Promise.resolve();let C=!1;function L(t){_.push(t)}let R=!1;const S=new Set;function P(){if(!R){R=!0;do{for(let t=0;t<x.length;t+=1){const e=x[t];$(e),T(e.$$)}for($(null),x.length=0;w.length;)w.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];S.has(e)||(S.add(e),e())}_.length=0}while(x.length);for(;k.length;)k.pop()();C=!1,R=!1,S.clear()}}function T(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}const X=new Set;function j(t,e){t&&t.i&&(X.delete(t),t.i(e))}function A(t,e,n,i){if(t&&t.o){if(X.has(t))return;X.add(t),undefined.c.push((()=>{X.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function N(t){t&&t.c()}function O(t,n,s){const{fragment:l,on_mount:c,on_destroy:r,after_update:a}=t.$$;l&&l.m(n,s),L((()=>{const n=c.map(e).filter(o);r?r.push(...n):i(n),t.$$.on_mount=[]})),a.forEach(L)}function z(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function B(t,e){-1===t.$$.dirty[0]&&(x.push(t),C||(C=!0,E.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function G(e,o,s,l,c,a,u=[-1]){const d=v;$(e);const f=o.props||{},h=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let m=!1;if(h.ctx=s?s(e,f,((t,n,...i)=>{const o=i.length?i[0]:n;return h.ctx&&c(h.ctx[t],h.ctx[t]=o)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](o),m&&B(e,t)),n})):[],h.update(),m=!0,i(h.before_update),h.fragment=!!l&&l(h.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);h.fragment&&h.fragment.l(t),t.forEach(r)}else h.fragment&&h.fragment.c();o.intro&&j(e.$$.fragment),O(e,o.target,o.anchor),P()}$(d)}class q{$destroy(){z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function F(t){return new Promise((function(e,n){const i=Object.assign(document.createElement("img"));function o(){i.onload=null,i.onerror=null}i.onload=function(){o(),e(i)},i.onerror=function(){o(),n(new Error('Failed to load the image "'+t+'"'))},i.src=t,i.crossOrigin="anonymous"}))}function M(e){let n,o,s,g,v,$,b,y,x,w,_,k,E,C,L,R,S,P,T,X,j,A,N,O;return{c(){n=a("section"),o=a("h1"),o.textContent="Get Flowkey URL",s=d(),g=a("hr"),v=d(),$=a("div"),b=a("div"),y=a("div"),y.textContent='Go to a lesson or a song on Flowkey\'s website. The sheet music at the bottom of the page is actually a set of\n        images. Right click on one of these images and select "Copy image address". Paste the result below :',x=d(),w=a("div"),_=a("label"),_.textContent="URL",k=d(),E=a("div"),C=a("input"),L=d(),R=a("p"),R.textContent="The URL is not valid",S=d(),P=a("button"),T=u("Load images"),j=d(),A=a("div"),A.innerHTML='<div class="is-flex is-justify-content-center"><img class="image" src="flowkey-screen.png" alt=""/></div>',h(o,"class","title"),h(y,"class","block"),h(_,"class","label is-medium"),h(_,"for","url"),h(C,"id","url"),h(C,"class","input is-medium"),h(C,"type","text"),h(C,"placeholder","https://flowkeycdn.com/sheets/XXXXXXXX/150/5.png"),p(C,"is-success",e[1]&&""!==e[0]),p(C,"is-danger",!e[1]&&""!==e[0]),h(E,"class","control"),h(R,"class","help is-danger is-size-6 mb-2 svelte-ez5o36"),p(R,"visibilty-hidden",e[1]||""===e[0]),P.disabled=X=!e[1],h(P,"class","button is-primary"),p(P,"is-loading",e[2]),h(w,"class","field"),h(b,"class","column is-three-fifths"),h(A,"class","column"),h($,"class","columns"),h(n,"class","section is-size-5")},m(t,i){c(t,n,i),l(n,o),l(n,s),l(n,g),l(n,v),l(n,$),l($,b),l(b,y),l(b,x),l(b,w),l(w,_),l(w,k),l(w,E),l(E,C),m(C,e[0]),l(w,L),l(w,R),l(w,S),l(w,P),l(P,T),l($,j),l($,A),N||(O=[f(C,"input",e[5]),f(P,"click",e[3])],N=!0)},p(t,[e]){1&e&&C.value!==t[0]&&m(C,t[0]),3&e&&p(C,"is-success",t[1]&&""!==t[0]),3&e&&p(C,"is-danger",!t[1]&&""!==t[0]),3&e&&p(R,"visibilty-hidden",t[1]||""===t[0]),2&e&&X!==(X=!t[1])&&(P.disabled=X),4&e&&p(P,"is-loading",t[2])},i:t,o:t,d(t){t&&r(n),N=!1,i(O)}}}function U(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,s){function l(t){try{r(i.next(t))}catch(t){s(t)}}function c(t){try{r(i.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,c)}r((i=i.apply(t,e||[])).next())}))};const o=y();let s=[],l="",c="",r=!1;let a=!1;return t.$$.update=()=>{16&t.$$.dirty&&o("images",s),1&t.$$.dirty&&n(1,r=function(t){const e=/(https:\/\/flowkeycdn.com\/sheets\/.*\/150\/)(\d+.png)/.exec(t);return!!e&&(l=e[1],!0)}(c))},[c,r,a,function(){return i(this,void 0,void 0,(function*(){n(2,a=!0),n(4,s=yield async function(t){const e=[];let n=0;for(;;){const i=[];for(let o=5*n;o<5*(n+1);o++){const n=F(t+`${o}.png`).then((t=>{e[o]=t}));i.push(n)}if((await Promise.allSettled(i)).some((t=>"rejected"==t.status)))break;n++}if(0==e.length)throw new Error(`Not image found at url: "${t}"`);return e}(l)),n(2,a=!1)}))},s,function(){c=this.value,n(0,c)}]}class I extends q{constructor(t){super(),G(this,t,U,M,s,{})}}function D(t,e,n){const i=t.slice();return i[20]=e[n],i}function H(t){let e,n,i,o=t[20]+"";return{c(){e=a("option"),n=u(o),e.__value=i=t[20],e.value=e.__value},m(t,i){c(t,e,i),l(e,n)},p(t,s){32&s&&o!==(o=t[20]+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,o),32&s&&i!==(i=t[20])&&(e.__value=i,e.value=e.__value)},d(t){t&&r(e)}}}function J(e){let n,o,s,v,$,b,y,x,w,_,k,E,C,L,R,S,P,T,X,j,A,N,O,z,B,G,q,F,M,U,I,J,K,Q,V,W,Y,Z,tt,et,nt,it,ot=e[5],st=[];for(let t=0;t<ot.length;t+=1)st[t]=H(D(e,ot,t));return{c(){n=a("section"),o=a("h1"),o.textContent="Generate the sheet music",s=d(),v=a("hr"),$=d(),b=a("div"),y=a("div"),x=a("div"),w=a("label"),w.textContent="Title",_=d(),k=a("div"),E=a("input"),L=d(),R=a("div"),S=a("div"),P=a("label"),P.textContent="Subtitle",T=d(),X=a("div"),j=a("input"),N=d(),O=a("div"),z=a("label"),z.textContent="Number of images per row",B=d(),G=a("div"),q=a("select");for(let t=0;t<st.length;t+=1)st[t].c();var t,i,l;U=d(),I=a("div"),J=a("button"),K=u("Generate"),V=d(),W=a("button"),Y=u("Download as PNG"),tt=d(),et=a("div"),et.innerHTML='<div id="canvas-container" class="box svelte-77eyrq"><canvas id="canvas"></canvas></div>',h(o,"class","title"),h(w,"class","label is-medium"),h(w,"for","title"),h(E,"id","title"),h(E,"class","input is-medium"),h(E,"type","text"),h(E,"placeholder","Ode to joy"),E.disabled=C=!e[0].length,h(k,"class","control"),h(x,"class","field"),h(y,"class","column"),h(P,"class","label is-medium"),h(P,"for","subtitle"),h(j,"id","subtitle"),h(j,"class","input is-medium"),h(j,"type","text"),h(j,"placeholder","Beethoven"),j.disabled=A=!e[0].length,h(X,"class","control"),h(S,"class","field"),h(R,"class","column"),h(b,"class","columns"),h(z,"class","label is-medium"),h(z,"for","imagesPerRow"),h(q,"id","imagesPerRow"),q.disabled=F=!e[0].length,h(G,"class","select"),h(O,"class","field mb-5"),h(J,"class","button is-primary"),J.disabled=Q=!e[0].length,h(W,"class","button is-primary ml-2"),W.disabled=Z=!e[3],h(I,"class","is-flex"),h(et,"class","mt-6 svelte-77eyrq"),t="overflow",i="auto",et.style.setProperty(t,i,l?"important":""),p(et,"display-none",!e[3]),h(n,"class","section is-size-5")},m(t,i){c(t,n,i),l(n,o),l(n,s),l(n,v),l(n,$),l(n,b),l(b,y),l(y,x),l(x,w),l(x,_),l(x,k),l(k,E),m(E,e[1]),l(b,L),l(b,R),l(R,S),l(S,P),l(S,T),l(S,X),l(X,j),m(j,e[2]),l(n,N),l(n,O),l(O,z),l(O,B),l(O,G),l(G,q);for(let t=0;t<st.length;t+=1)st[t].m(q,null);g(q,e[4].toString()),l(n,U),l(n,I),l(I,J),l(J,K),l(I,V),l(I,W),l(W,Y),l(n,tt),l(n,et),nt||(it=[f(E,"input",e[9]),f(j,"input",e[10]),f(q,"change",e[7]),f(J,"click",e[6]),f(W,"click",e[8])],nt=!0)},p(t,[e]){if(1&e&&C!==(C=!t[0].length)&&(E.disabled=C),2&e&&E.value!==t[1]&&m(E,t[1]),1&e&&A!==(A=!t[0].length)&&(j.disabled=A),4&e&&j.value!==t[2]&&m(j,t[2]),32&e){let n;for(ot=t[5],n=0;n<ot.length;n+=1){const i=D(t,ot,n);st[n]?st[n].p(i,e):(st[n]=H(i),st[n].c(),st[n].m(q,null))}for(;n<st.length;n+=1)st[n].d(1);st.length=ot.length}1&e&&F!==(F=!t[0].length)&&(q.disabled=F),48&e&&M!==(M=t[4].toString())&&g(q,t[4].toString()),1&e&&Q!==(Q=!t[0].length)&&(J.disabled=Q),8&e&&Z!==(Z=!t[3])&&(W.disabled=Z),8&e&&p(et,"display-none",!t[3])},i:t,o:t,d(t){t&&r(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(st,t),nt=!1,i(it)}}}let K=100;function Q(t,e,n){let i,o,s,{images:l=[]}=e,c=!1,r=0,a=0,u=150,d="",f="",h=2,m=[];var g;function p(){if(!l.length||!s||!i)return;const t=Math.ceil(l.length/h);u=d||f?150:0,r=l[0].width*h+K,a=l[0].height*t+30*(t-1)+u+K,i.width=r,i.height=a,s.style.width=r+"px",s.style.height=a+"px",n(3,c=!0),function(){o.clearRect(0,0,r,a),o.fillStyle="white",o.fillRect(0,0,r,a);let t=0,e=u+50;for(const[n,i]of l.entries())n%h==0&&(t=50),n%h==0&&0!=n&&(e+=i.height+30),o.drawImage(i,t,e),t+=i.width}(),v(d,f)}function v(t,e){c&&(!t&&!e&&0!==u||(t||e)&&0===u?p():(o.clearRect(0,0,r,u),o.textBaseline="middle",o.textAlign="center",o.fillStyle="black",t&&(o.font="bold 48px serif",o.fillText(t,r/2,50)),e&&(o.font="30px serif",o.fillText(e,r/2,100))))}return g=()=>{s=document.getElementById("canvas-container"),i=document.getElementById("canvas"),o=i.getContext("2d")},b().$$.on_mount.push(g),t.$$set=t=>{"images"in t&&n(0,l=t.images)},t.$$.update=()=>{var e;7&t.$$.dirty&&(n(5,(e=l.length,m=0===e?[]:1===e?[1]:[2,e,...Array.from(Array(l.length-1).keys()).map((t=>t+1)).filter((t=>2!=t))])),v(d,f))},[l,d,f,c,h,m,p,function(t){n(4,h=+t.target.value),c&&p()},function(){const t=document.createElement("a");t.href=i.toDataURL("image/png"),t.download=d&&f?`${d} - ${f}`:d||f?d||f:"my-sheet",t.download+=".png",t.click()},function(){d=this.value,n(1,d)},function(){f=this.value,n(2,f)}]}class V extends q{constructor(t){super(),G(this,t,Q,J,s,{images:0})}}function W(t){let e,n,i,o,s,u;return i=new I({}),i.$on("images",t[1]),s=new V({props:{images:t[0]}}),{c(){e=a("section"),n=a("div"),N(i.$$.fragment),o=d(),N(s.$$.fragment),h(n,"class","container"),h(e,"class","section")},m(t,r){c(t,e,r),l(e,n),O(i,n,null),l(n,o),O(s,n,null),u=!0},p(t,[e]){const n={};1&e&&(n.images=t[0]),s.$set(n)},i(t){u||(j(i.$$.fragment,t),j(s.$$.fragment,t),u=!0)},o(t){A(i.$$.fragment,t),A(s.$$.fragment,t),u=!1},d(t){t&&r(e),z(i),z(s)}}}function Y(t,e,n){let i=[];return[i,function(t){n(0,i=t.detail)}]}return new class extends q{constructor(t){super(),G(this,t,Y,W,s,{})}}({target:document.querySelector("svelte-app")})}();
//# sourceMappingURL=bundle.js.map
